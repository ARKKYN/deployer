function Uploader(e){if(!(this instanceof Uploader))return new Uploader(e);isString(e)&&(e={trigger:e});var t={trigger:null,name:null,action:null,data:null,accept:null,change:null,error:null,multiple:!0,success:null};e&&$.extend(t,e);var a=$(t.trigger);t.action=t.action||a.data("action")||"/upload",t.name=t.name||a.attr("name")||a.data("name")||"file",t.data=t.data||parse(a.data("data")),t.accept=t.accept||a.data("accept"),t.success=t.success||a.data("success"),this.settings=t,this.setup(),this.bind()}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}function createInputs(e){if(!e)return[];var t,a=[];for(var n in e)t=document.createElement("input"),t.type="hidden",t.name=n,t.value=e[n],a.push(t);return a}function parse(e){if(!e)return{};for(var t={},a=e.split("&"),n=function(e){return decodeURIComponent(e.replace(/\+/g," "))},s=0;s<a.length;s++){var i=a[s].split("="),r=n(i[0]),o=n(i[1]);t[r]=o}return t}function findzIndex(e){for(var t=e.parentsUntil("body"),a=0,n=0;n<t.length;n++){var s=t.eq(n);"static"!==s.css("position")&&(a=parseInt(s.css("zIndex"),10)||a)}return a}function newIframe(){var e="iframe-uploader-"+iframeCount,t=$('<iframe name="'+e+'" />').hide();return iframeCount+=1,t}function MultipleUploader(e){if(!(this instanceof MultipleUploader))return new MultipleUploader(e);isString(e)&&(e={trigger:e});var t=$(e.trigger),a=[];t.each(function(t,n){e.trigger=n,a.push(new Uploader(e))}),this._uploaders=a}Lang.addMessages({en:{"app.yes":"Yes","app.no":"No","dashboard.pending":":count pending deployment|:count pending deployments","dashboard.running":":count running deployment|:count running deployments","dashboard.deployment_number":"Deployment #:id","deployments.completed":"Completed","deployments.completed_with_errors":"Completed with errors","deployments.pending":"Pending","deployments.deploying":"Deploying","deployments.running":"Running","deployments.cancelled":"Cancelled","deployments.failed":"Failed","variables.create":"Add a new variable","variables.edit":"Edit the variable","projects.create":"Add a new project","projects.edit":"Edit a project","projects.finished":"Finished","projects.pending":"Pending","projects.deploying":"Deploying","projects.failed":"Failed","projects.not_deployed":"Not Deployed","checkUrls.create":"Add a new URL","checkUrls.edit":"Edit the URL","checkUrls.successful":"Online","checkUrls.failed":"Offline","checkUrls.untested":"Unknown","checkUrls.length":"Minutes","commands.create":"Add a new command","commands.edit":"Edit a command","groups.create":"Add a new group","groups.edit":"Edit a group","users.create":"Add a new user","users.edit":"Edit a user","templates.create":"Add a new template","templates.edit":"Edit the template","sharedFiles.create":"Add a new file or folder","sharedFiles.edit":"Edit the file or folder","configFiles.create":"Add a new file","configFiles.edit":"Edit the file","channels.create":"Add a new notification","channels.edit":"Edit the notification","channels.custom":"Custom","channels.slack":"Slack","channels.hipchat":"Hipchat","channels.twilio":"Twilio","channels.mail":"E-mail","channels.create_slack":"Add a new Slack notification","channels.create_hipchat":"Add a new Hipchat notification","channels.create_twilio":"Add a new Twilio notification","channels.create_mail":"Add a new e-mail notification","channels.create_custom":"Add a new custom notification","channels.edit_slack":"Edit the Slack notification","channels.edit_hipchat":"Edit the Hipchat notification","channels.edit_twilio":"Edit the Twilio notification","channels.edit_mail":"Edit the e-mail notification","channels.edit_custom":"Edit the custom notification","servers.create":"Add a new server","servers.edit":"Edit the server","servers.successful":"Successful","servers.testing":"Testing","servers.failed":"Failed","servers.untested":"Untested","heartbeats.create":"Add a new heartbeat","heartbeats.edit":"Edit the heartbeat","heartbeats.ok":"Healthy","heartbeats.untested":"Waiting for Heartbeat","heartbeats.missing":"Missing in Action","heartbeats.interval_10":"10 minutes","heartbeats.interval_30":"30 minutes","heartbeats.interval_60":"1 hour","heartbeats.interval_120":"2 hours","heartbeats.interval_720":"12 hours","heartbeats.interval_1440":"1 day","heartbeats.interval_10080":"1 week"},zh:{"app.yes":"是","app.no":"否","dashboard.pending":":count 个正在等待的部署","dashboard.running":":count 个正在运行的部署","dashboard.deployment_number":"部署 #:id","deployments.completed":"已完成","deployments.completed_with_errors":"已完成（有错误）","deployments.pending":"正在等待","deployments.deploying":"正在部署","deployments.running":"正在运行","deployments.cancelled":"已取消","deployments.failed":"失败","variables.create":"添加新变量","variables.edit":"编辑变量","projects.create":"添加新项目","projects.edit":"编辑项目","projects.finished":"已完成","projects.pending":"正在等待","projects.deploying":"正在部署","projects.failed":"失败","projects.not_deployed":"未部署","checkUrls.create":"添加新的 URL","checkUrls.edit":"编辑 URL","checkUrls.successful":"在线","checkUrls.failed":"离线","checkUrls.untested":"未知","checkUrls.length":"分钟","commands.create":"添加新命令","commands.edit":"编辑命令","groups.create":"添加新项目分组","groups.edit":"编辑项目分组","users.create":"添加新用户","users.edit":"编辑用户","templates.create":"添加新模板","templates.edit":"编辑模板","sharedFiles.create":"添加新文件或文件夹","sharedFiles.edit":"编辑文件或文件夹","configFiles.create":"添加新文件","configFiles.edit":"编辑文件","channels.create":"添加新的通知","channels.edit":"编辑通知","channels.custom":"自定义","channels.slack":"Slack 通知","channels.hipchat":"Hipchat","channels.twilio":"Twilio","channels.mail":"E-mail","channels.create_slack":"添加新的 slack 通知","channels.create_hipchat":"添加新的 Hipchat 通知","channels.create_twilio":"添加新的 Twilio 通知","channels.create_mail":"添加新的 e-mail 通知","channels.create_custom":"添加新的自定义通知","channels.edit_slack":"编辑 slack 通知","channels.edit_hipchat":"编辑 Hipchat 通知","channels.edit_twilio":"编辑 Twilio 通知","channels.edit_mail":"编辑 e-mail 通知","channels.edit_custom":"编辑自定义通知","servers.create":"添加新服务器","servers.edit":"编辑服务器","servers.successful":"成功","servers.testing":"正在测试","servers.failed":"失败","servers.untested":"未测试","heartbeats.create":"添加新心跳","heartbeats.edit":"编辑心跳","heartbeats.ok":"健康","heartbeats.untested":"正在等待心跳","heartbeats.missing":"丢失","heartbeats.interval_10":"10 分钟","heartbeats.interval_30":"30 分钟","heartbeats.interval_60":"1 小时","heartbeats.interval_120":"2 小时","heartbeats.interval_720":"12 小时","heartbeats.interval_1440":"1 天","heartbeats.interval_10080":"1 周"},ru:{"app.yes":"Да","app.no":"Нет","dashboard.pending":":count ожидающая сборка|:count ожидающих сборок","dashboard.running":":count запущенная сборка|:count запущенных сборок","dashboard.deployment_number":"Сборка #:id","deployments.completed":"Завершена","deployments.completed_with_errors":"Завершена с ошибками","deployments.pending":"Ожидание","deployments.deploying":"Сборка","deployments.running":"Работает","deployments.cancelled":"Отменена","deployments.failed":"Провалена","variables.create":"Добавить новую переменную","variables.edit":"Редактировать переменную","projects.create":"Добавить новый проект","projects.edit":"Редактировать проект","projects.finished":"Закончена","projects.pending":"Ожидает","projects.deploying":"Собирается","projects.failed":"Провалена","projects.not_deployed":"Не собиралась","checkUrls.create":"Добавить новый URL","checkUrls.edit":"Редактировать URL","checkUrls.successful":"Онлайн","checkUrls.failed":"Оффлайн","checkUrls.untested":"Неизвестен","checkUrls.length":"Минут","commands.create":"Добавить новую команду","commands.edit":"Редактировать команду","groups.create":"Добавить новую группу","groups.edit":"Редактировать группу","users.create":"Добавить нового пользователя","users.edit":"Редактировать пользователя","templates.create":"Добавить новый шаблон","templates.edit":"Редактировать шаблон","sharedFiles.create":"Добавить новый файл или директорию","sharedFiles.edit":"Редактировать файл или директорию","configFiles.create":"Добавить новый файл","configFiles.edit":"Редактировать файл","channels.create":"Добавить новое оповещение","channels.edit":"Редактировать оповещение","channels.custom":"Свой тип","channels.slack":"Slack","channels.hipchat":"Hipchat","channels.twilio":"Twilio","channels.mail":"E-mail","channels.create_slack":"Добавить новое оповещение в Slack","channels.create_hipchat":"Добавить новое оповещение в Hipchat","channels.create_twilio":"Добавить новое оповещение в Twilio","channels.create_mail":"Добавить новое оповещение по E-mail","channels.create_custom":"Добавить новое свой тип оповещения","channels.edit_slack":"Редактировать оповещение в Slack","channels.edit_hipchat":"Редактировать оповещение в Hipchat","channels.edit_twilio":"Редактировать оповещение в Twilio","channels.edit_mail":"Редактировать оповещение по E-mail","channels.edit_custom":"Редактировать оповещение свой тип оповещения","servers.create":"Добавить новый сервер","servers.edit":"Редактировать сервер","servers.successful":"Успешно","servers.testing":"Проверяется","servers.failed":"Провалено","servers.untested":"Не проверено","heartbeats.create":"Add a new heartbeat","heartbeats.edit":"Edit the heartbeat","heartbeats.ok":"Healthy","heartbeats.untested":"Waiting for Heartbeat","heartbeats.missing":"Missing in Action","heartbeats.interval_10":"10 minutes","heartbeats.interval_30":"30 minutes","heartbeats.interval_60":"1 hour","heartbeats.interval_120":"2 hours","heartbeats.interval_720":"12 hours","heartbeats.interval_1440":"1 day","heartbeats.interval_10080":"1 week"}}),$.ajaxPrefilter(function(e,t,a){a.setRequestHeader("X-CSRF-Token",$('meta[name="token"]').attr("content"))});var app=app||{};toastr.options.closeButton=!0,toastr.options.progressBar=!0,toastr.options.preventDuplicates=!0,toastr.options.closeMethod="fadeOut",toastr.options.closeDuration=300,toastr.options.closeEasing="swing",toastr.options.positionClass="toast-bottom-right",toastr.options.timeOut=5e3,toastr.options.extendedTimeOut=7e3,function(e){function t(){e.ajax({type:"GET",url:"/timeline"}).success(function(t){e("#timeline").html(t)})}function a(t){t.model.time=moment(t.model.started_at).format("h:mm:ss A"),t.model.url="/deployment/"+t.model.id,e("#deployment_info_"+t.model.id).remove(),e("#pending_menu, #deploying_menu").show();var a=_.template(e("#deployment-list-template").html()),n=a(t.model);t.model.status===l?e("#pending_menu ul.menu").append(n):t.model.status===d&&e("#deploying_menu ul.menu").append(n);var s=e("#pending_menu ul.menu li").length,i=e("#deploying_menu ul.menu li").length,r=Lang.choice("dashboard.pending",s,{count:s});0===s&&e("#pending_menu").hide();var o=Lang.choice("dashboard.running",i,{count:i});0===i&&e("#deploying_menu").hide(),e("#deploying_menu span.label-warning").html(i),e("#deploying_menu .header").text(o),e("#pending_menu span.label-info").html(s),e("#pending_menu .header").text(r)}if(null==window.location.href.match(/login|password/)){Lang.setLocale(e('meta[name="locale"]').attr("content"));var n=0,s=1,i=2,r=3,o=0,l=1,d=2,p=3,c=4,h=5;app.project_id=app.project_id||null,app.listener=io.connect(e('meta[name="socket_url"]').attr("content"),{query:"jwt="+e('meta[name="jwt"]').attr("content"),transports:["websocket","polling"]}),app.connection_error=!1,app.listener.on("connect_error",function(t){app.connection_error||e("#socket_offline").show(),app.connection_error=!0}),app.listener.on("connect",function(){e("#socket_offline").hide(),app.connection_error=!1}),app.listener.on("reconnect",function(){e("#socket_offline").hide(),app.connection_error=!1}),app.listener.on("deployment:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(n){a(n),e("#timeline").length>0&&t();var s=e("#deployment_"+n.model.id);if(s.length>0){e("td:nth-child(4)",s).text(n.model.committer),n.model.commit_url?e("td:nth-child(5)",s).html('<a href="'+n.model.commit_url+'" target="_blank">'+n.model.short_commit+"</a>"):e("td:nth-child(5)",s).text(n.model.short_commit);var i="clock-o",r="info",l=Lang.get("deployments.pending"),m=!1,u=!1;n.model.status=parseInt(n.model.status);var f=e("td:nth-child(7) span.label",s);n.model.status===o?(i="check",r="success",l=Lang.get("deployments.completed"),m=!0,u=!0):n.model.status===d?(i="spinner fa-pulse",r="warning",l=Lang.get("deployments.running")):n.model.status===p?(i="warning",r="danger",l=Lang.get("deployments.failed"),m=!0):n.model.status===c?(i="warning",r="success",l=Lang.get("deployments.completed_with_errors"),m=!0,u=!0):n.model.status===h&&(i="warning",r="danger",l=Lang.get("deployments.cancelled"),m=!0),m&&(e("button#deploy_project:disabled").removeAttr("disabled"),e("td:nth-child(8) a.btn-cancel",s).remove(),u&&e("button.btn-rollback").removeClass("hide")),f.attr("class","label label-"+r),e("i",f).attr("class","fa fa-"+i),e("span",f).text(l)}else if(0===e("#timeline").length){var v=Lang.get("dashboard.deployment_number",{id:n.model.id});n.model.status===o?toastr.success(v+" - "+Lang.get("deployments.completed"),n.model.project_name):n.model.status===p?toastr.error(v+" - "+Lang.get("deployments.failed"),n.model.project_name):n.model.status===c&&toastr.warning(v+" - "+Lang.get("deployments.completed_with_errors"),n.model.project_name)}}),app.listener.on("group:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(t){e("#sidebar_group_"+t.model.id).html(t.model.name)}),app.listener.on("project:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(t){e("#sidebar_project_"+t.model.id).html(t.model.name);var a=e("#project_"+t.model.id);if(a.length>0){var o="question-circle",l="primary",d=Lang.get("projects.not_deployed");t.model.status=parseInt(t.model.status);var p=e("td:nth-child(3) span.label",a);t.model.status===n?(o="check",l="success",d=Lang.get("projects.finished")):t.model.status===i?(o="spinner fa-pulse",l="warning",d=Lang.get("projects.deploying")):t.model.status===r?(o="warning",l="danger",d=Lang.get("projects.failed")):t.model.status===s&&(o="clock-o",l="info",d=Lang.get("projects.pending")),e("td:first a",a).text(t.model.name),e("td:nth-child(2)",a).text(moment(t.model.last_run).format("Do MMMM YYYY h:mm:ss A")),p.attr("class","label label-"+l),e("i",p).attr("class","fa fa-"+o),e("span",p).text(d)}}),app.listener.on("project:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(t){e("#sidebar_project_"+t.model.id).parent("li").remove(),parseInt(t.model.id)===parseInt(app.project_id)&&(window.location.href="/")}),e(document).ready(function(){e("#pending_menu ul.menu li").length>0&&e("#pending_menu").show(),e("#deploying_menu ul.menu li").length>0&&e("#deploying_menu").show()})}}(jQuery);var app=app||{};!function(e){function t(t,a){var s=n;s.data=a,e("option",t).remove(),e(t).select2("destroy"),e(t).select2(s)}function a(t){e(":input",t).not(".close").removeAttr("disabled"),e("button.close",t).show(),e("i.fa-spin",t).removeClass("fa-spin")}var n={width:"80%",minimumResultsForSearch:6};e("select.deployment-source").select2(n),e("div.tab-content #deployments").length>0&&app.listener.on("project:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(n){if(parseInt(n.model.id)===parseInt(app.project_id)){t("select.deployment-source#deployment_branch",n.model.branches),t("select.deployment-source#deployment_tag",n.model.tags.reverse());var s=e(".modal#reason");a(s)}}),e("button.btn-refresh-branches").on("click",function(t){var n=e(t.currentTarget),s=n.data("project-id"),i=e("i",n),r=n.parents(".modal");e(".fa-spin",n).length>0||(e(":input",r).not(".close").attr("disabled","disabled"),e("button.close",r).hide(),i.addClass("fa-spin"),e.ajax({type:"POST",url:"/projects/"+s+"/refresh"}).fail(function(){a(r)}))}),e(".deployment-source:radio").on("change",function(t){var a=e(t.currentTarget);e("div.deployment-source-container").hide(),"branch"===a.val()?e("#deployment_branch").parent("div").show():"tag"===a.val()&&e("#deployment_tag").parent("div").show()}),e("#reason").on("show.bs.modal",function(t){var a=e(this);e(".callout-danger",a).hide()}),e("#reason button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal"),i=e("input[name=source]:checked").val();return e(".has-error",i).removeClass("has-error"),"branch"!==i&&"tag"!==i||""!==e("#deployment_"+i).val()?(n.addClass("fa-refresh fa-spin").removeClass("fa-save"),void e("button.close",s).hide()):(e("#deployment_"+i).parentsUntil("div").addClass("has-error"),e(".callout-danger",s).show(),void t.stopPropagation())}),e("#project").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("projects.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),e("#template-list",n).hide(),e(".nav-tabs a:first",n).tab("show"),a.hasClass("btn-edit")?(s=Lang.get("projects.edit"),e(".btn-danger",n).show()):(e("#template-list",n).show(),e("#project_id").val(""),e("#project_name").val(""),e("#project_repository").val(""),e("#project_branch").val("master"),e("#project_group_id").val(e("#project_group_id option:first").val()),e("#project_template_id").val(e("#project_template_id option:first").val()),e("#project_builds_to_keep").val(10),e("#project_url").val(""),e("#project_build_url").val(""),e("#project_allow_other_branch").prop("checked",!0),e("#project_include_dev").prop("checked",!1),e("#project_private_key").val("")),n.find(".modal-title span").text(s)}),e("#project button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Projects.get(e("#project_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#project button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#project_id").val();if(i)var r=app.Projects.get(i);else var r=new app.Project;r.save({name:e("#project_name").val(),repository:e("#project_repository").val(),branch:e("#project_branch").val(),group_id:parseInt(e("#project_group_id").val()),builds_to_keep:e("#project_builds_to_keep").val(),url:e("#project_url").val(),build_url:e("#project_build_url").val(),template_id:e("#project_template_id")?parseInt(e("#project_template_id").val()):null,allow_other_branch:e("#project_allow_other_branch").is(":checked"),include_dev:e("#project_include_dev").is(":checked"),private_key:e("#project_private_key").val()},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Projects.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form :input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#project_group_id").select2({width:"100%",minimumResultsForSearch:1/0}),e("#project_template_id").select2({width:"100%",minimumResultsForSearch:1/0}),app.Project=Backbone.Model.extend({urlRoot:"/admin/projects"});var s=Backbone.Collection.extend({model:app.Project});app.Projects=new s,app.ProjectsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#project_list tbody"),e("#project_list").hide(),e("#no_projects").show(),this.listenTo(app.Projects,"add",this.addOne),this.listenTo(app.Projects,"reset",this.addAll),this.listenTo(app.Projects,"remove",this.addAll),this.listenTo(app.Projects,"all",this.render),app.listener.on("project:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Projects.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("project:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(t){if(app.Projects.add(t.model),0===e("#sidebar_project_"+t.model.id).length){var a=_.template(e("#project-sidebar-template").html());e("#group_"+t.model.group_id+"_projects").append(a(t.model))}}),app.listener.on("project:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(t){var a=app.Projects.get(parseInt(t.model.id));a&&app.Projects.remove(a),e("#project_"+t.model.id).parent("li").remove(),parseInt(t.model.id)===parseInt(app.project_id)&&(window.location.href="/")})},render:function(){app.Projects.length?(e("#no_projects").hide(),e("#project_list").show()):(e("#no_projects").show(),e("#project_list").hide())},addOne:function(e){var t=new app.ProjectView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Projects.each(this.addOne,this)}}),app.ProjectView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editProject"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#project-template").html())},render:function(){var e=this.model.toJSON();return e.deploy=!!e.last_run&&moment(e.last_run).format("Do MMMM YYYY h:mm:ss A"),this.$el.html(this.template(e)),this},editProject:function(){e("#project_id").val(this.model.id),e("#project_name").val(this.model.get("name")),e("#project_repository").val(this.model.get("repository")),e("#project_branch").val(this.model.get("branch")),e("#project_group_id").val(this.model.get("group_id")),e("#project_builds_to_keep").val(this.model.get("builds_to_keep")),e("#project_url").val(this.model.get("url")),e("#project_build_url").val(this.model.get("build_url")),e("#project_allow_other_branch").prop("checked",this.model.get("allow_other_branch")===!0),e("#project_include_dev").prop("checked",this.model.get("include_dev")===!0),e("#project_private_key").val("")}}),e("#new_webhook").on("click",function(t){var a=e(t.currentTarget),n=a.data("project-id"),s=e("i",a);e(".fa-spin",a).length>0||(a.attr("disabled","disabled"),s.addClass("fa-spin"),e.ajax({type:"GET",url:"/webhook/"+n+"/refresh"}).fail(function(e){}).done(function(t){e("#webhook").html(t.url)}).always(function(){s.removeClass("fa-spin"),a.removeAttr("disabled")}))})}(jQuery);var app=app||{};!function(e){e("#template").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("templates.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("templates.edit"),e(".btn-danger",n).show()):(e("#template_id").val(""),e("#template_name").val("")),n.find(".modal-title span").text(s)}),e("#template button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Templates.get(e("#template_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#template button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#template_id").val();if(i)var r=app.Templates.get(i);else var r=new app.Template;r.save({name:e("#template_name").val()},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||(app.Templates.add(a),window.location.href="/admin/templates/"+a.id)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.Template=Backbone.Model.extend({urlRoot:"/admin/templates"});var t=Backbone.Collection.extend({model:app.Template});app.Templates=new t,app.TemplatesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#template_list tbody"),e("#template_list").hide(),e("#no_templates").show(),this.listenTo(app.Templates,"add",this.addOne),this.listenTo(app.Templates,"reset",this.addAll),this.listenTo(app.Templates,"remove",this.addAll),this.listenTo(app.Templates,"all",this.render),app.listener.on("template:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Templates.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("template:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(e){app.Templates.add(e.model)}),app.listener.on("template:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Templates.get(parseInt(e.model.id));t&&app.Templates.remove(t)})},render:function(){app.Templates.length?(e("#no_templates").hide(),e("#template_list").show()):(e("#no_templates").show(),e("#template_list").hide())},addOne:function(e){var t=new app.TemplateView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Templates.each(this.addOne,this)}}),app.TemplateView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editTemplate"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#template-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},editTemplate:function(){e("#template_id").val(this.model.id),e("#template_name").val(this.model.get("name"))}})}(jQuery);var app=app||{};!function(e){var t=0,a=2,n=3;e("#server_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,a,n){n(t,a);var s=[];e("tbody tr td:first-child",a.el[0]).each(function(t,a){s.push(e(a).data("server-id"))}),e.ajax({url:"/servers/reorder",method:"POST",data:{servers:s}})}}),e("#server").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("servers.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),e("#add-server-command",n).hide(),a.hasClass("btn-edit")?(s=Lang.get("servers.edit"),e(".btn-danger",n).show()):(e("#server_id").val(""),e("#server_name").val(""),e("#server_address").val(""),e("#server_port").val("22"),e("#server_user").val(""),e("#server_path").val(""),e("#server_deploy_code").prop("checked",!0),e("#add-server-command",n).show()),n.find(".modal-title span").text(s)}),e("#server #server_name").autocomplete({serviceUrl:"/servers/autocomplete",dataType:"json",noCache:!0,preserveInput:!0,transformResult:function(t){return{suggestions:e.map(t.suggestions,function(e){var t=e.name+" ("+e.user+"@"+e.ip_address+")";return{value:t,data:e}})}},onSelect:function(t){var a=t.data;e("#server_name").val(a.name),e("#server_address").val(a.ip_address),e("#server_port").val(a.port),e("#server_user").val(a.user),e("#server_path").val(a.path),e("#server_deploy_code").prop("checked",a.deploy_code)}}),e("#server button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Servers.get(e("#server_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#server button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#server_id").val();if(i)var r=app.Servers.get(i);else var r=new app.Server;r.save({name:e("#server_name").val(),ip_address:e("#server_address").val(),port:e("#server_port").val(),user:e("#server_user").val(),path:e("#server_path").val(),deploy_code:e("#server_deploy_code").is(":checked"),project_id:parseInt(e('input[name="project_id"]').val()),add_commands:e("#server_commands").is(":checked")},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Servers.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.Server=Backbone.Model.extend({urlRoot:"/servers"});var s=Backbone.Collection.extend({model:app.Server,comparator:function(e,t){return e.get("name")>t.get("name")?-1:e.get("name")<t.get("name")?1:0}});app.Servers=new s,app.ServersTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#server_list tbody"),e("#no_servers").show(),e("#server_list").hide(),this.listenTo(app.Servers,"add",this.addOne),this.listenTo(app.Servers,"reset",this.addAll),this.listenTo(app.Servers,"remove",this.addAll),this.listenTo(app.Servers,"all",this.render),app.listener.on("server:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Servers.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("server:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(e){parseInt(e.model.project_id)===parseInt(app.project_id)&&app.Servers.add(e.model)}),app.listener.on("server:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Servers.get(parseInt(e.model.id));t&&app.Servers.remove(t)})},render:function(){app.Servers.length?(e("#no_servers").hide(),e("#server_list").show()):(e("#no_servers").show(),e("#server_list").hide())},addOne:function(e){var t=new app.ServerView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Servers.each(this.addOne,this)}}),app.ServerView=Backbone.View.extend({tagName:"tr",events:{"click .btn-test":"testConnection","click .btn-edit":"editServer"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#server-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="primary",e.icon_css="question",e.status=Lang.get("servers.untested"),parseInt(this.model.get("status"))===t?(e.status_css="success",
e.icon_css="check",e.status=Lang.get("servers.successful")):parseInt(this.model.get("status"))===n?(e.status_css="warning",e.icon_css="spinner fa-pulse",e.status=Lang.get("servers.testing")):parseInt(this.model.get("status"))===a&&(e.status_css="danger",e.icon_css="warning",e.status=Lang.get("servers.failed")),this.$el.html(this.template(e)),this},editServer:function(){e("#server_id").val(this.model.id),e("#server_name").val(this.model.get("name")),e("#server_address").val(this.model.get("ip_address")),e("#server_port").val(this.model.get("port")),e("#server_user").val(this.model.get("user")),e("#server_path").val(this.model.get("path")),e("#server_deploy_code").prop("checked",this.model.get("deploy_code")===!0)},testConnection:function(){if(parseInt(this.model.get("status"))!==n){this.model.set({status:n});var t=this;e.ajax({type:"POST",url:this.model.urlRoot+"/"+this.model.id+"/test"}).fail(function(e){t.model.set({status:a})})}}})}(jQuery);var app=app||{};!function(e){var t=0,a=2;e("#heartbeat").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("heartbeats.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("heartbeats.edit"),e(".btn-danger",n).show()):(e("#heartbeat_id").val(""),e("#heartbeat_name").val(""),e("#heartbeat_interval_30").prop("checked",!0)),n.find(".modal-title span").text(s)}),e("#heartbeat button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Heartbeats.get(e("#heartbeat_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#heartbeat button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#heartbeat_id").val();if(i)var r=app.Heartbeats.get(i);else var r=new app.Heartbeat;r.save({name:e("#heartbeat_name").val(),interval:parseInt(e("input[name=interval]:checked").val()),project_id:parseInt(e('input[name="project_id"]').val())},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Heartbeats.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.Heartbeat=Backbone.Model.extend({urlRoot:"/heartbeats"});var n=Backbone.Collection.extend({model:app.Heartbeat,comparator:function(e,t){return e.get("name")>t.get("name")?-1:e.get("name")<t.get("name")?1:0}});app.Heartbeats=new n,app.HeartbeatsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#heartbeat_list tbody"),e("#no_heartbeats").show(),e("#heartbeat_list").hide(),this.listenTo(app.Heartbeats,"add",this.addOne),this.listenTo(app.Heartbeats,"reset",this.addAll),this.listenTo(app.Heartbeats,"remove",this.addAll),this.listenTo(app.Heartbeats,"all",this.render),app.listener.on("heartbeat:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Heartbeats.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("heartbeat:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(e){parseInt(e.model.project_id)===parseInt(app.project_id)&&app.Heartbeats.add(e.model)}),app.listener.on("heartbeat:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Heartbeats.get(parseInt(e.model.id));t&&app.Heartbeats.remove(t)})},render:function(){app.Heartbeats.length?(e("#no_heartbeats").hide(),e("#heartbeat_list").show()):(e("#no_heartbeats").show(),e("#heartbeat_list").hide())},addOne:function(e){var t=new app.HeartbeatView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Heartbeats.each(this.addOne,this)}}),app.HeartbeatView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editHeartbeat"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#heartbeat-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="primary",e.icon_css="question",e.status=Lang.get("heartbeats.untested"),e.has_run=!1,parseInt(this.model.get("status"))===t?(e.status_css="success",e.icon_css="check",e.status=Lang.get("heartbeats.ok"),e.has_run=!0):parseInt(this.model.get("status"))===a&&(e.status_css="danger",e.icon_css="warning",e.status=Lang.get("heartbeats.missing"),e.has_run=!!e.last_activity),e.interval_label=Lang.get("heartbeats.interval_"+e.interval),e.formatted_date="",e.has_run&&(e.formatted_date=moment(e.last_activity).format("Do MMMM YYYY h:mm:ss A")),this.$el.html(this.template(e)),this},editHeartbeat:function(){e("#heartbeat_id").val(this.model.id),e("#heartbeat_name").val(this.model.get("name")),e("#heartbeat_interval_"+this.model.get("interval")).prop("checked",!0)}})}(jQuery);var app=app||{};!function(e){function t(t,a){e("#notification .modal-title span").text(Lang.get("channels."+a+"_"+t));var n=e("#notification .modal-title i").removeClass().addClass("fa"),s="cogs";"slack"===t?s="slack":"hipchat"===t?(n.addClass("fa-flip-horizontal"),s="comment-o"):"mail"===t?s="envelope-o":"twilio"===t&&(s="mobile"),n.addClass("fa-"+s),e("#notification .modal-footer").show(),e(".channel-config").hide(),e("#channel-type").hide(),e("#channel-name").show(),e("#channel-triggers").show(),e("#channel-config-"+t).show(),e("#notification_type").val(t)}e("#notification").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this);e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".callout-warning",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?e(".btn-danger",n).show():(e("#notification_id").val(""),e("#notification_name").val(""),e("#notification_type").val(""),e("#notification :input[id^=notification_config]").val(""),e("#notification .channel-config input[type=checkbox]").prop("checked",!0),e("#notification .modal-footer").hide(),e(".channel-config").hide(),e("#channel-type").show(),n.find(".modal-title span").text(Lang.get("channels.create")))}),e("#notification #channel-type a.btn-app").on("click",function(a){var n=e(a.currentTarget),s=e("#notification");if(n.attr("disabled"))return void e(".callout-warning",s).show();e(".callout-warning",s).hide();var i=n.data("type");t(i,"create")}),e("#notification button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Notifications.get(e("#notification_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#notification button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#notification_id").val();if(i)var r=app.Notifications.get(i);else var r=new app.Notification;var o={config:null,name:e("#notification_name").val(),type:e("#notification_type").val(),project_id:parseInt(e('input[name="project_id"]').val()),on_deployment_success:e("#notification_on_deployment_success").is(":checked"),on_deployment_failure:e("#notification_on_deployment_failure").is(":checked"),on_link_down:e("#notification_on_link_down").is(":checked"),on_link_still_down:e("#notification_on_link_still_down").is(":checked"),on_link_recovered:e("#notification_on_link_recovered").is(":checked"),on_heartbeat_missing:e("#notification_on_heartbeat_missing").is(":checked"),on_heartbeat_still_missing:e("#notification_on_heartbeat_still_missing").is(":checked"),on_heartbeat_recovered:e("#notification_on_heartbeat_recovered").is(":checked")};e("#notification #channel-config-"+o.type+" :input[id^=notification_config]").each(function(t,a){var n=e(a).attr("name");o[n]=e(a).val()}),r.save(o,{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Notifications.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.Notification=Backbone.Model.extend({urlRoot:"/notifications"});var a=Backbone.Collection.extend({model:app.Notification});app.Notifications=new a,app.NotificationsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#notification_list tbody"),e("#no_notifications").show(),e("#notification_list").hide(),this.listenTo(app.Notifications,"add",this.addOne),this.listenTo(app.Notifications,"reset",this.addAll),this.listenTo(app.Notifications,"remove",this.addAll),this.listenTo(app.Notifications,"all",this.render),app.listener.on("channel:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Notifications.get(parseInt(e.model.id));server&&t.set(e.model)}),app.listener.on("channel:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(e){parseInt(e.model.project_id)===parseInt(app.project_id)&&app.Notifications.add(e.model)}),app.listener.on("channel:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Notifications.get(parseInt(e.model.id));t&&app.Notifications.remove(t)})},render:function(){app.Notifications.length?(e("#no_notifications").hide(),e("#notification_list").show()):(e("#no_notifications").show(),e("#notification_list").hide())},addOne:function(e){var t=new app.NotificationView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Notifications.each(this.addOne,this)}}),app.NotificationView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editNotification"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#notification-template").html())},render:function(){var e=this.model.toJSON();return e.icon="cogs",e.label=Lang.get("channels.custom"),"custom"!==this.model.get("type")&&(e.label=Lang.get("channels."+this.model.get("type"))),"slack"===this.model.get("type")?e.icon="slack":"hipchat"===this.model.get("type")?e.icon="comment-o fa-flip-horizontal":"mail"===this.model.get("type")?e.icon="envelope-o":"twilio"===this.model.get("type")&&(e.icon="mobile"),this.$el.html(this.template(e)),this},editNotification:function(){var a=this.model.get("type");e.each(this.model.get("config"),function(t,n){e("#channel-config-"+a+" #notification_config_"+t).val(n)}),e("#notification_id").val(this.model.id),e("#notification_name").val(this.model.get("name")),e("#notification_type").val(a),e("#notification_on_deployment_success").prop("checked",this.model.get("on_deployment_success")===!0),e("#notification_on_deployment_failure").prop("checked",this.model.get("on_deployment_failure")===!0),e("#notification_on_link_down").prop("checked",this.model.get("on_link_down")===!0),e("#notification_on_link_still_down").prop("checked",this.model.get("on_link_still_down")===!0),e("#notification_on_link_recovered").prop("checked",this.model.get("on_link_recovered")===!0),e("#notification_on_heartbeat_missing").prop("checked",this.model.get("on_heartbeat_missing")===!0),e("#notification_on_heartbeat_still_missing").prop("checked",this.model.get("on_heartbeat_still_missing")===!0),e("#notification_on_heartbeat_recovered").prop("checked",this.model.get("on_heartbeat_recovered")===!0),t(this.model.get("type"),"edit")}})}(jQuery);var app=app||{};!function(e){e("#sharefile").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("sharedFiles.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("sharedFiles.edit"),e(".btn-danger",n).show()):(e("#file_id").val(""),e("#name").val(""),e("#file").val("")),n.find(".modal-title span").text(s)}),e("#sharefile button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.SharedFiles.get(e("#file_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#sharefile button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#file_id").val();if(i)var r=app.SharedFiles.get(i);else var r=new app.SharedFile;r.save({name:e("#name").val(),file:e("#file").val(),target_type:e('input[name="target_type"]').val(),target_id:parseInt(e('input[name="target_id"]').val())},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.SharedFiles.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.SharedFile=Backbone.Model.extend({urlRoot:"/shared-files"});var t=Backbone.Collection.extend({model:app.SharedFile});app.SharedFiles=new t,app.SharedFilesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#file_list tbody"),e("#no_files").show(),e("#file_list").hide(),this.listenTo(app.SharedFiles,"add",this.addOne),this.listenTo(app.SharedFiles,"reset",this.addAll),this.listenTo(app.SharedFiles,"remove",this.addAll),this.listenTo(app.SharedFiles,"all",this.render),app.listener.on("sharedfile:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.SharedFiles.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("sharedfile:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(t){var a=e('input[name="target_type"]').val(),n=e('input[name="target_id"]').val();a==t.model.target_type&&parseInt(t.model.target_id)===parseInt(n)&&app.SharedFiles.add(t.model)}),app.listener.on("sharedfile:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.SharedFiles.get(parseInt(e.model.id));t&&app.SharedFiles.remove(t)})},render:function(){app.SharedFiles.length?(e("#no_files").hide(),e("#file_list").show()):(e("#no_files").show(),e("#file_list").hide())},addOne:function(e){var t=new app.FileView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.SharedFiles.each(this.addOne,this)}}),app.FileView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editFile"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#files-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},editFile:function(){e("#file_id").val(this.model.id),e("#name").val(this.model.get("name")),e("#file").val(this.model.get("file"))}})}(jQuery);var app=app||{};!function(e){var t,a;e("#configfile, #view-configfile").on("hidden.bs.modal",function(e){t.destroy()}),e("#view-configfile").on("show.bs.modal",function(e){t=ace.edit("preview-content"),t.setReadOnly(!0),t.getSession().setUseWrapMode(!0);var n=a.substr(a.lastIndexOf(".")+1).toLowerCase();"php"===n||"ini"===n?t.getSession().setMode("ace/mode/"+n):"yml"===n&&t.getSession().setMode("ace/mode/yaml")}),e("#configfile").on("show.bs.modal",function(a){var n=e(a.relatedTarget),s=e(this),i=Lang.get("configFiles.create");t=ace.edit("config-file-content");var r=e("#config-file-path").val(),o=r.substr(r.lastIndexOf(".")+1).toLowerCase();"php"===o||"ini"===o?t.getSession().setMode("ace/mode/"+o):"yml"===o&&t.getSession().setMode("ace/mode/yaml"),e(".btn-danger",s).hide(),e(".callout-danger",s).hide(),e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),n.hasClass("btn-edit")?(i=Lang.get("configFiles.edit"),e(".btn-danger",s).show()):(e("#config_file_id").val(""),e("#config-file-name").val(""),e("#config-file-path").val(""),t.setValue(""),t.gotoLine(1)),s.find(".modal-title span").text(i)}),e("#configfile button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.ConfigFiles.get(e("#config_file_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#configfile button.btn-save").on("click",function(a){var n=e(a.currentTarget),s=n.find("i"),i=n.parents(".modal");s.addClass("fa-refresh fa-spin").removeClass("fa-save"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide();var r=e("#config_file_id").val();if(r)var o=app.ConfigFiles.get(r);else var o=new app.ConfigFile;o.save({name:e("#config-file-name").val(),path:e("#config-file-path").val(),content:t.getValue(),target_type:e('input[name="target_type"]').val(),target_id:parseInt(e('input[name="target_id"]').val())},{wait:!0,success:function(a,n,o){i.modal("hide"),e(".callout-danger",i).hide(),s.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",i).show(),i.find("input").removeAttr("disabled"),r||app.ConfigFiles.add(n),t.setValue(""),t.gotoLine(1)},error:function(t,a,n){e(".callout-danger",i).show();var r=a.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),s.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),app.ConfigFile=Backbone.Model.extend({urlRoot:"/config-file"});var n=Backbone.Collection.extend({model:app.ConfigFile});app.ConfigFiles=new n,app.ConfigFilesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#configfile_list tbody"),e("#no_configfiles").show(),e("#configfile_list").hide(),this.listenTo(app.ConfigFiles,"add",this.addOne),this.listenTo(app.ConfigFiles,"reset",this.addAll),this.listenTo(app.ConfigFiles,"remove",this.addAll),this.listenTo(app.ConfigFiles,"all",this.render),app.listener.on("configfile:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.ConfigFiles.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("configfile:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(t){var a=e('input[name="target_type"]').val(),n=e('input[name="target_id"]').val();a==t.model.target_type&&parseInt(t.model.target_id)===parseInt(n)&&app.ConfigFiles.add(t.model)}),app.listener.on("configfile:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.ConfigFiles.get(parseInt(e.model.id));t&&app.ConfigFiles.remove(t)})},render:function(){app.ConfigFiles.length?(e("#no_configfiles").hide(),e("#configfile_list").show()):(e("#no_configfiles").show(),e("#configfile_list").hide())},addOne:function(e){var t=new app.ConfigFileView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.ConfigFiles.each(this.addOne,this)}}),app.ConfigFileView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editFile","click .btn-view":"viewFile"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#config-files-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},viewFile:function(){a=this.model.get("path"),e("#preview-content").text(this.model.get("content"))},editFile:function(){e("#config_file_id").val(this.model.id),e("#config-file-name").val(this.model.get("name")),e("#config-file-path").val(this.model.get("path")),e("#config-file-content").text(this.model.get("content"))}})}(jQuery);var app=app||{};!function(e){var t=0,a=2;e("#checkurl").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("checkUrls.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("checkUrls.edit"),e(".btn-danger",n).show()):(e("#url_id").val(""),e("#url_name").val(""),e("#url_url").val(""),e("#period_5").prop("checked",!0)),n.find(".modal-title span").text(s)}),e("#checkurl button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.CheckUrls.get(e("#url_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#checkurl button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#url_id").val();if(i)var r=app.CheckUrls.get(i);else var r=new app.CheckUrl;r.save({name:e("#url_name").val(),url:e("#url_url").val(),period:parseInt(e("input[name=period]:checked").val()),project_id:parseInt(e('input[name="project_id"]').val())},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.CheckUrls.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.CheckUrl=Backbone.Model.extend({urlRoot:"/check-url"});var n=Backbone.Collection.extend({model:app.CheckUrl});app.CheckUrls=new n,app.CheckUrlsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#checkurl_list tbody"),e("#no_checkurls").show(),e("#checkurl_list").hide(),this.listenTo(app.CheckUrls,"add",this.addOne),this.listenTo(app.CheckUrls,"reset",this.addAll),this.listenTo(app.CheckUrls,"remove",this.addAll),this.listenTo(app.CheckUrls,"all",this.render),app.listener.on("checkurl:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.CheckUrls.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("checkurl:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(e){parseInt(e.model.project_id)===parseInt(app.project_id)&&app.CheckUrls.add(e.model)}),app.listener.on("checkurl:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.CheckUrls.get(parseInt(e.model.id));t&&app.CheckUrls.remove(t)})},render:function(){app.CheckUrls.length?(e("#no_checkurls").hide(),e("#checkurl_list").show()):(e("#no_checkurls").show(),e("#checkurl_list").hide())},addOne:function(e){var t=new app.CheckUrlView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.CheckUrls.each(this.addOne,this)}}),app.CheckUrlView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editUrl","click .btn-view":"viewLog"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#checkUrls-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="primary",e.icon_css="question",e.status=Lang.get("checkUrls.untested"),e.has_run=!1,e.has_log=!1,parseInt(this.model.get("status"))===a?(e.status_css="danger",e.icon_css="warning",e.status=Lang.get("checkUrls.failed"),e.has_run=!!e.last_seen,e.has_log=!!e.last_log):parseInt(this.model.get("status"))===t&&(e.status_css="success",e.icon_css="check",e.status=Lang.get("checkUrls.successful"),e.has_run=!0),e.formatted_date="",e.has_run&&(e.formatted_date=moment(e.last_seen).format("Do MMMM YYYY h:mm:ss A")),e.interval_label=e.period+" "+Lang.get("checkUrls.length"),this.$el.html(this.template(e)),this},viewLog:function(){e("#response pre").text(this.model.get("last_log"))},editUrl:function(){e("#url_id").val(this.model.id),e("#url_name").val(this.model.get("name")),e("#url_url").val(this.model.get("url")),e("#period_"+this.model.get("period")).prop("checked",!0)}})}(jQuery);var app=app||{};!function(e){e("#variable").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("variables.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("variables.edit"),e(".btn-danger",n).show()):(e("#variable_id").val(""),e("#variable_name").val(""),e("#variable_value").val("")),n.find(".modal-title span").text(s)}),e("#variable button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Variables.get(e("#variable_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#variable button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#variable_id").val();if(i)var r=app.Variables.get(i);else var r=new app.Variable;r.save({name:e("#variable_name").val(),value:e("#variable_value").val(),target_type:e('input[name="target_type"]').val(),target_id:parseInt(e('input[name="target_id"]').val())},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Variables.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.Variable=Backbone.Model.extend({urlRoot:"/variables",initialize:function(){}});var t=Backbone.Collection.extend({model:app.Variable});app.Variables=new t,app.VariablesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#variable_list tbody"),e("#variable_list").hide(),this.listenTo(app.Variables,"add",this.addOne),this.listenTo(app.Variables,"reset",this.addAll),this.listenTo(app.Variables,"remove",this.addAll),this.listenTo(app.Variables,"all",this.render),app.listener.on("variable:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(t){e("#variable_"+t.model.id).html(t.model.name);var a=app.Variables.get(parseInt(t.model.id));a&&a.set(t.model)}),app.listener.on("variable:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(t){var a=e('input[name="target_type"]').val(),n=e('input[name="target_id"]').val();a==t.model.target_type&&parseInt(t.model.target_id)===parseInt(n)&&app.Variables.add(t.model)}),app.listener.on("variable:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Variables.get(parseInt(e.model.id));t&&app.Variables.remove(t)})},render:function(){app.Variables.length?e("#variable_list").show():e("#variable_list").hide()},addOne:function(e){var t=new app.VariableView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Variables.each(this.addOne,this)}}),app.VariableView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editVariable"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#variable-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},editVariable:function(){e("#variable_id").val(this.model.id),e("#variable_name").val(this.model.get("name")),e("#variable_value").val(this.model.get("value"))}})}(jQuery);var app=app||{};!function(e){function t(t,n){o||(o=!0,e.ajax({type:"GET",url:"/log/"+n}).done(function(e){var n=a(e.output?e.output:""),s=!1;t.scrollTop()+t.innerHeight()>=t.get(0).scrollHeight&&(s=!0),
t.html(n),s&&t.scrollTop(t.get(0).scrollHeight)}).always(function(){o=!1}))}function a(e){return e.replace(/<\/error>/g,"</span>").replace(/<\/info>/g,"</span>").replace(/<error>/g,'<span class="text-red">').replace(/<info>/g,'<span class="text-default">')}var n=0,s=2,i=3,r=4;e("#redeploy").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=a.data("deployment-id"),s=a.data("optional-commands")+"",i=s.split(",");i=s.length>0?e.map(i,function(e){return parseInt(e,10)}):[];var r=e(this);e("form",r).prop("action","/deployment/"+n+"/rollback"),e("input:checkbox",r).each(function(t,a){var n=e(a);n.prop("checked",!1),e.inArray(parseInt(n.val(),10),i)!=-1&&n.prop("checked",!0)})}),e(".btn-cancel").on("click",function(t){var a=e(t.currentTarget),n=a.data("deployment-id");e("form#abort_"+n).trigger("submit")});var o=!1;e("#log").on("show.bs.modal",function(n){var s=e(n.relatedTarget),i=s.attr("id").replace("log_",""),r=e("h3 span",s.parents(".box")).text(),l=e(this),d=e("pre",l),p=e("#loading",l);d.hide(),p.show(),e("#action",l).text(r),d.text(""),o=!0,e.ajax({type:"GET",url:"/log/"+i}).done(function(e){var n=a(e.output?e.output:"");d.html(n),d.show(),p.hide(),app.listener.on("serverlog-"+i+":REBELinBLUE\\Deployer\\Events\\ServerOutputChanged",function(e){e.log_id===parseInt(i)&&t(d,e.log_id)})}).always(function(){o=!1})}),e("#log").on("hide.bs.modal",function(){o=!1}),app.ServerLog=Backbone.Model.extend({urlRoot:"/status"});var l=Backbone.Collection.extend({model:app.ServerLog});app.Deployment=new l,app.DeploymentView=Backbone.View.extend({el:"#app",$containers:[],events:{},initialize:function(){var t=this;e(".deploy-step tbody").each(function(a,n){t.$containers.push({step:parseInt(e(n).attr("id").replace("step_","")),element:n})}),this.listenTo(app.Deployment,"add",this.addOne),this.listenTo(app.Deployment,"reset",this.addAll),this.listenTo(app.Deployment,"remove",this.addAll),this.listenTo(app.Deployment,"all",this.render),app.listener.on("serverlog:REBELinBLUE\\Deployer\\Events\\ServerLogChanged",function(e){var t=app.Deployment.get(e.log_id);t&&t.set({status:e.status,output:e.output,runtime:e.runtime,started_at:!!e.started_at&&e.started_at,finished_at:!!e.finished_at&&e.finished_at})}),app.listener.on("deployment:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(t){parseInt(t.model.project_id)===parseInt(app.project_id)&&t.model.repo_failure&&e("#repository_error").show()})},addOne:function(t){var a=new app.LogView({model:t}),n=_.find(this.$containers,function(e){return parseInt(e.step)===parseInt(t.get("deploy_step_id"))});e(n.element).append(a.render().el)},addAll:function(){e(this.$containers).each(function(e,t){t.html("")}),app.Commands.each(this.addOne,this)}}),app.LogView=Backbone.View.extend({tagName:"tr",events:{},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#log-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="info",e.icon_css="clock-o",e.status=Lang.get("deployments.pending"),parseInt(this.model.get("status"))===n?(e.status_css="success",e.icon_css="check",e.status=Lang.get("deployments.completed")):parseInt(this.model.get("status"))===s?(e.status_css="warning",e.icon_css="spinner fa-spin",e.status=Lang.get("deployments.running")):parseInt(this.model.get("status"))!==i&&parseInt(this.model.get("status"))!==r||(e.status_css="danger",e.icon_css="warning",e.status=Lang.get("deployments.failed"),parseInt(this.model.get("status"))===r&&(e.status=Lang.get("deployments.cancelled"))),e.formatted_start_time=!!e.started_at&&moment(e.started_at).format("h:mm:ss A"),e.formatted_end_time=!!e.finished_at&&moment(e.finished_at).format("h:mm:ss A"),this.$el.html(this.template(e)),this}})}(jQuery);var app=app||{};!function(e){e(".command-list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,a,n){n(t,a);var s=[];e("tbody tr td:first-child",a.el[0]).each(function(t,a){s.push(e(a).data("command-id"))}),e.ajax({url:"/commands/reorder",method:"POST",data:{commands:s}})}});var t;e("#command").on("hidden.bs.modal",function(e){t.destroy()}),e("#command").on("show.bs.modal",function(a){var n=e(a.relatedTarget),s=e(this),i=Lang.get("commands.create");t=ace.edit("command_script"),t.getSession().setMode("ace/mode/sh"),e(".btn-danger",s).hide(),e(".callout-danger",s).hide(),e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),n.hasClass("btn-edit")?(i=Lang.get("commands.edit"),e(".btn-danger",s).show()):(e("#command_id").val(""),e("#command_step").val(n.data("step")),e("#command_name").val(""),t.setValue(""),t.gotoLine(1),e("#command_user").val(""),e("#command_optional").prop("checked",!1),e("#command_default_on").prop("checked",!1),e("#command_default_on_row").addClass("hide"),e(".command-server").prop("checked",!0)),s.find(".modal-title span").text(i)}),e("#command button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Commands.get(e("#command_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#command_optional").on("change",function(t){e("#command_default_on_row").addClass("hide"),e(this).is(":checked")===!0&&e("#command_default_on_row").removeClass("hide")}),e("#command button.btn-save").on("click",function(a){var n=e(a.currentTarget),s=n.find("i"),i=n.parents(".modal");s.addClass("fa-refresh fa-spin").removeClass("fa-save"),i.find(":input").attr("disabled","disabled"),e("button.close",i).hide();var r=e("#command_id").val();if(r)var o=app.Commands.get(r);else var o=new app.Command;var l=[];e(".command-server:checked").each(function(){l.push(e(this).val())}),o.save({name:e("#command_name").val(),script:t.getValue(),user:e("#command_user").val(),step:e("#command_step").val(),target_type:e('input[name="target_type"]').val(),target_id:parseInt(e('input[name="target_id"]').val()),servers:l,optional:e("#command_optional").is(":checked"),default_on:e("#command_default_on").is(":checked")},{wait:!0,success:function(a,n,o){i.modal("hide"),e(".callout-danger",i).hide(),s.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",i).show(),i.find(":input").removeAttr("disabled"),r||app.Commands.add(n),t.setValue(""),t.gotoLine(1)},error:function(t,a,n){e(".callout-danger",i).show();var r=a.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),s.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",i).show(),i.find(":input").removeAttr("disabled")}})}),app.Command=Backbone.Model.extend({urlRoot:"/commands",defaults:function(){return{order:app.Commands.nextOrder()}},isAfter:function(){return parseInt(this.get("step"))%3===0}});var a=Backbone.Collection.extend({model:app.Command,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:1}});app.Commands=new a,app.CommandsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$beforeList=e("#commands-before .command-list tbody"),this.$afterList=e("#commands-after .command-list tbody"),e(".no-commands").show(),e(".command-list").hide(),this.listenTo(app.Commands,"add",this.addOne),this.listenTo(app.Commands,"reset",this.addAll),this.listenTo(app.Commands,"remove",this.addAll),this.listenTo(app.Commands,"all",this.render),app.listener.on("command:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Commands.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("command:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(t){var a=e('input[name="target_type"]').val(),n=e('input[name="target_id"]').val();a==t.model.target_type&&parseInt(t.model.target_id)===parseInt(n)&&(parseInt(t.model.step)+1!==parseInt(app.command_action)&&parseInt(t.model.step)-1!==parseInt(app.command_action)||app.Commands.add(t.model))}),app.listener.on("command:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Commands.get(parseInt(e.model.id));t&&app.Commands.remove(t)})},render:function(){var t=app.Commands.find(function(e){return!e.isAfter()});"undefined"!=typeof t?(e("#commands-before .no-commands").hide(),e("#commands-before .command-list").show()):(e("#commands-before .no-commands").show(),e("#commands-before .command-list").hide());var a=app.Commands.find(function(e){return e.isAfter()});"undefined"!=typeof a?(e("#commands-after .no-commands").hide(),e("#commands-after .command-list").show()):(e("#commands-after .no-commands").show(),e("#commands-after .command-list").hide())},addOne:function(e){var t=new app.CommandView({model:e});e.isAfter()?this.$afterList.append(t.render().el):this.$beforeList.append(t.render().el)},addAll:function(){this.$beforeList.html(""),this.$afterList.html(""),app.Commands.each(this.addOne,this)}}),app.CommandView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editCommand"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#command-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},editCommand:function(){e("#command_id").val(this.model.id),e("#command_step").val(this.model.get("step")),e("#command_name").val(this.model.get("name")),e("#command_script").text(this.model.get("script")),e("#command_user").val(this.model.get("user")),e("#command_optional").prop("checked",this.model.get("optional")===!0),e("#command_default_on").prop("checked",this.model.get("default_on")===!0),e("#command_default_on_row").addClass("hide"),this.model.get("optional")===!0&&e("#command_default_on_row").removeClass("hide"),e(".command-server").prop("checked",!1),e(this.model.get("servers")).each(function(t,a){e("#command_server_"+a.id).prop("checked",!0)})}})}(jQuery);var app=app||{};!function(e){e("#user").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("users.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".existing-only",n).hide(),e(".new-only",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("users.edit"),e(".btn-danger",n).show(),e(".existing-only",n).show()):(e("#user_id").val(""),e("#user_name").val(""),e("#user_email").val(""),e("#user_password").val(""),e("#user_password_confirmation").val(""),e(".new-only",n).show()),n.find(".modal-title span").text(s)}),e("#user button.btn-delete").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-trash"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=app.Users.get(e("#user_id").val());i.destroy({wait:!0,success:function(t,a,i){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")},error:function(){n.removeClass("fa-refresh fa-spin").addClass("fa-trash"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#user button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#user_id").val();if(i)var r=app.Users.get(i);else var r=new app.User;r.save({name:e("#user_name").val(),email:e("#user_email").val(),password:e("#user_password").val(),password_confirmation:e("#user_password_confirmation").val()},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Users.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.User=Backbone.Model.extend({urlRoot:"/admin/users",initialize:function(){}});var t=Backbone.Collection.extend({model:app.User});app.Users=new t,app.UsersTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#user_list tbody"),this.listenTo(app.Users,"add",this.addOne),this.listenTo(app.Users,"reset",this.addAll),this.listenTo(app.Users,"remove",this.addAll),this.listenTo(app.Users,"all",this.render),app.listener.on("user:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(e){var t=app.Users.get(parseInt(e.model.id));t&&t.set(e.model)}),app.listener.on("user:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(e){app.Users.add(e.model)}),app.listener.on("user:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Users.get(parseInt(e.model.id));t&&app.Users.remove(t)})},addOne:function(e){var t=new app.UserView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Users.each(this.addOne,this)}}),app.UserView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editUser"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#user-template").html())},render:function(){var e=this.model.toJSON();return e.created=moment(e.created_at).format("Do MMMM YYYY h:mm:ss A"),this.$el.html(this.template(e)),this},editUser:function(){e("#user_id").val(this.model.id),e("#user_name").val(this.model.get("name")),e("#user_email").val(this.model.get("email"))}})}(jQuery);var app=app||{};!function(e){e("#group_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,a,n){n(t,a);var s=[];e("tbody tr td:first-child",a.el[0]).each(function(t,a){s.push(e(a).data("group-id"))}),e.ajax({url:"/admin/groups/reorder",method:"POST",data:{groups:s}})}}),e("#group").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=e(this),s=Lang.get("groups.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),a.hasClass("btn-edit")?(s=Lang.get("groups.edit"),e(".btn-danger",n).show()):(e("#group_id").val(""),e("#group_name").val("")),n.find(".modal-title span").text(s)}),e("#group button.btn-save").on("click",function(t){var a=e(t.currentTarget),n=a.find("i"),s=a.parents(".modal");n.addClass("fa-refresh fa-spin").removeClass("fa-save"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var i=e("#group_id").val();if(i)var r=app.Groups.get(i);else var r=new app.Group;r.save({name:e("#group_name").val()},{wait:!0,success:function(t,a,r){s.modal("hide"),e(".callout-danger",s).hide(),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled"),i||app.Groups.add(a)},error:function(t,a,i){e(".callout-danger",s).show();var r=a.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(t,a){a=e(a);var n=a.attr("name");if("undefined"!=typeof r[n]){var s=a.parents("div.form-group");s.addClass("has-error"),s.append(e("<span>").attr("class","label label-danger").text(r[n]))}}),n.removeClass("fa-refresh fa-spin").addClass("fa-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),app.Group=Backbone.Model.extend({urlRoot:"/admin/groups",initialize:function(){}});var t=Backbone.Collection.extend({model:app.Group});app.Groups=new t,app.GroupsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#group_list tbody"),this.listenTo(app.Groups,"add",this.addOne),this.listenTo(app.Groups,"reset",this.addAll),this.listenTo(app.Groups,"remove",this.addAll),this.listenTo(app.Groups,"all",this.render),app.listener.on("group:REBELinBLUE\\Deployer\\Events\\ModelChanged",function(t){e("#group_"+t.model.id).html(t.model.name);var a=app.Groups.get(parseInt(t.model.id));a&&a.set(t.model)}),app.listener.on("group:REBELinBLUE\\Deployer\\Events\\ModelCreated",function(t){if(app.Groups.add(t.model),0===e("#sidebar_group_"+t.model.id).length){var a=_.template(e("#group-sidebar-template").html());e(a(t.model)).insertBefore(e(".sidebar-menu li.treeview").last())}}),app.listener.on("group:REBELinBLUE\\Deployer\\Events\\ModelTrashed",function(e){var t=app.Groups.get(parseInt(e.model.id));t&&app.Groups.remove(t)})},addOne:function(e){var t=new app.GroupView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),app.Servers.each(this.addOne,this)}}),app.GroupView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"editGroup"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#group-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},editGroup:function(){e("#group_id").val(this.model.id),e("#group_name").val(this.model.get("name"))}})}(jQuery);var iframeCount=0;Uploader.prototype.setup=function(){this.form=$('<form method="post" enctype="multipart/form-data"target="" action="'+this.settings.action+'" />'),this.iframe=newIframe(),this.form.attr("target",this.iframe.attr("name"));var e=this.settings.data;this.form.append(createInputs(e)),window.FormData?this.form.append(createInputs({_uploader_:"formdata"})):this.form.append(createInputs({_uploader_:"iframe"}));var t=document.createElement("input");t.type="file",t.name=this.settings.name,this.settings.accept&&(t.accept=this.settings.accept),this.settings.multiple&&(t.multiple=!0,t.setAttribute("multiple","multiple")),this.input=$(t);var a=$(this.settings.trigger);return this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:a.outerHeight(),fontSize:Math.max(64,5*a.outerHeight())}),this.form.append(this.input),this.form.css({position:"absolute",top:a.offset().top,left:a.offset().left,overflow:"hidden",width:a.outerWidth(),height:a.outerHeight(),zIndex:findzIndex(a)+10}).appendTo("body"),this},Uploader.prototype.bind=function(){var e=this,t=$(e.settings.trigger);t.mouseenter(function(){e.form.css({top:t.offset().top,left:t.offset().left,width:t.outerWidth(),height:t.outerHeight()})}),e.bindInput()},Uploader.prototype.bindInput=function(){var e=this;e.input.change(function(t){e._files=this.files||[{name:t.target.value}];var a=e.input.val();if(e.settings.change)e.settings.change.call(e,e._files);else if(a)return e.submit()})},Uploader.prototype.submit=function(){var e=this;if(window.FormData&&e._files){var t=new FormData(e.form.get(0));t.append(e.settings.name,e._files);var a;if(e.settings.progress){var n=e._files;a=function(){var t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){var a=0,s=t.loaded||t.position,i=t.total;t.lengthComputable&&(a=Math.ceil(s/i*100)),e.settings.progress(t,s,i,a,n)},!1),t}}return $.ajax({url:e.settings.action,type:"post",processData:!1,contentType:!1,data:t,xhr:a,context:this,success:e.settings.success,error:e.settings.error}),this}return e.iframe=newIframe(),e.form.attr("target",e.iframe.attr("name")),$("body").append(e.iframe),e.iframe.one("load",function(){$('<iframe src="javascript:false;"></iframe>').appendTo(e.form).remove();var t;try{t=$(this).contents().find("body").html()}catch(a){t="cross-domain"}$(this).remove(),t?e.settings.success&&e.settings.success(t):e.settings.error&&e.settings.error(e.input.val())}),e.form.submit(),this},Uploader.prototype.refreshInput=function(){var e=this.input.clone();this.input.before(e),this.input.off("change"),this.input.remove(),this.input=e,this.bindInput()},Uploader.prototype.change=function(e){return e?(this.settings.change=e,this):this},Uploader.prototype.success=function(e){var t=this;return this.settings.success=function(a){t.refreshInput(),e&&e(a)},this},Uploader.prototype.error=function(e){var t=this;return this.settings.error=function(a){e&&(t.refreshInput(),e(a))},this},Uploader.prototype.enable=function(){this.input.prop("disabled",!1),this.input.css("cursor","pointer")},Uploader.prototype.disable=function(){this.input.prop("disabled",!0),this.input.css("cursor","not-allowed")},MultipleUploader.prototype.submit=function(){return $.each(this._uploaders,function(e,t){t.submit()}),this},MultipleUploader.prototype.change=function(e){return $.each(this._uploaders,function(t,a){a.change(e)}),this},MultipleUploader.prototype.success=function(e){return $.each(this._uploaders,function(t,a){a.success(e)}),this},MultipleUploader.prototype.error=function(e){return $.each(this._uploaders,function(t,a){a.error(e)}),this},MultipleUploader.prototype.enable=function(){return $.each(this._uploaders,function(e,t){t.enable()}),this},MultipleUploader.prototype.disable=function(){return $.each(this._uploaders,function(e,t){t.disable()}),this},MultipleUploader.Uploader=Uploader;var app=app||{};!function(e){if(0!==e("#upload").length){e("#skin").select2({minimumResultsForSearch:1/0}),e("#scheme").select2({minimumResultsForSearch:1/0}),e("#language").select2({minimumResultsForSearch:1/0}),e("#skin").on("change",function(){e("body").removeClass(),e("body").addClass("skin-"+e(this).find(":selected").val())}),e("#two-factor-auth").on("change",function(){var t=e(".auth-code");e(this).is(":checked")?t.removeClass("hide"):t.addClass("hide")}),e("#request-change-email").on("click",function(){var t=e(this).parents(".box");t.children(".overlay").removeClass("hide"),e.post("/profile/email",function(e){"success"==e&&(t.children(".overlay").addClass("hide"),t.find(".help-block").removeClass("hide"))})});var t={};e(".avatar>img").cropper({aspectRatio:1,preview:".avatar-preview",crop:function(e){t.dataX=Math.round(e.x),t.dataY=Math.round(e.y),t.dataHeight=Math.round(e.height),t.dataWidth=Math.round(e.width),t.dataRotate=Math.round(e.rotate)},built:function(){e("#upload-overlay").addClass("hide")}});new Uploader({trigger:"#upload",name:"file",action:"/profile/upload",accept:"image/*",data:{_token:e('meta[name="token"]').attr("content")},multiple:!1,change:function(){e("#upload-overlay").removeClass("hide"),this.submit()},error:function(t){t.responseJSON.file?alert(t.responseJSON.file.join("")):t.responseJSON.error&&alert(t.responseJSON.error.message),e("#upload-overlay").addClass("hide")},success:function(a){"success"===a.message&&(e(".avatar>img").cropper("replace",a.image),t.path=a.path,e(".current-avatar-preview").addClass("hide"),e(".avatar-preview").removeClass("hide"),e("#save-avatar").removeClass("hide"))}});e("#save-avatar").on("click",function(){e("#upload-overlay").removeClass("hide"),e(".avatar-message .alert").addClass("hide"),e.post("/profile/avatar",t).success(function(t){e("#upload-overlay").addClass("hide"),t.image?(e(".avatar-message .alert.alert-success").removeClass("hide"),e("#use-gravatar").removeClass("hide")):e(".avatar-message .alert.alert-danger").removeClass("hide")})}),e("#use-gravatar").on("click",function(){e("#upload-overlay").removeClass("hide"),e(".avatar-message .alert").addClass("hide"),e.post("/profile/gravatar").success(function(t){e("#upload-overlay").addClass("hide"),e(".avatar-message .alert.alert-success").removeClass("hide"),e(".avatar-preview").addClass("hide"),e(".current-avatar-preview").removeClass("hide"),e(".current-avatar-preview").attr("src",t.image),e("#use-gravatar").addClass("hide"),e("#avatar-save-buttons button").addClass("hide")})})}}(jQuery);